# F3 数字逻辑电路基础（上）

处理器芯片的本质是数字电路

数字芯片=处理数字信号的芯片=处理`0`和`1`的芯片

## 通过晶体管实现0和1

金属-氧化物-半导体场效应晶体管（MOSFET）

栅极，源极，漏极

类比为生活中的开关

栅极电压 -> 手

源极和漏极 -> 开关连接的两端

<img src="https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/6f59f0809f5bd1e9065a0e3b2a41ee156cc10310.png" alt="image" style="zoom:80%;" />

### 晶体管开关原理

以nMOS为例, 根据其电气特性, nMOS的功能如下:

- 当栅极电压与源极电压之间的差值($V_G-V_S$)较大时, 源极和漏极导通, 相当于开关合上
- 当栅极电压与源极电压之间的差值($V_G-V_S$)较小时, 源极和漏极截止, 相当于开关断开

pMOS的功能表现与nMOS类似, $V_S-V_G$较大时导通, $V_S-V_G$较小时截止.

### CMOS(Complementary MOS)

nMOS+pMOS

用MOS管的开关特性实现0和1

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260123195444845.png" alt="image-20260123195436002" style="zoom:50%;" />

- 在A点加高电压时, 下方的n管(nMOS)导通, 上方的p管(pMOS)截止, 相当于Y点与地相连(中图), Y点电压低
- 在A点加低电压时, 下方的n管(nMOS)截止, 上方的p管(pMOS)导通, 相当于Y点与电源相连(右图), Y点电压高

逻辑`1`：高电平   逻辑`0`：低电平



## 通过晶体管搭建门电路

门电路=对状态进行运算

### 非运算（非门，反相器）

上图CMOS管

- A=1时，Y=0

- A=0时，Y=1

![image](https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/aa5b48e6a02556d4d67a7e443330b59ab82c1432.png)

### 与非运算（与非门）

- P1和P2并联, 其中一者导通时, Y为`1`; 

- N1和N2串联, 两者均导通时, Y为`0`

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260123200428768.png" alt="image-20260123200427014" style="zoom:50%;" />

|  A   |  B   |  Y   |
| :--: | :--: | :--: |
|  0   |  0   |  1   |
|  0   |  1   |  1   |
|  1   |  0   |  1   |
|  1   |  1   |  0   |

### 与运算（与门）

与门=与非门+非门

![image-20260123203253001](https://gitee.com/helloworld-dlx/typora/raw/master/20260123203259650.png)

|  A   |  B   |  Y   |
| :--: | :--: | :--: |
|  0   |  0   |  0   |
|  0   |  1   |  0   |
|  1   |  0   |  0   |
|  1   |  1   |  1   |

### 或非运算（或非门）

- P1和P2串联, 两者均导通时, Y为`1`
- N1和N2并联, 其中一者导通时, Y为`0`; 

![image](https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/27009d95075bd53667312a60e43c65d288ac0557.png)

|  A   |  B   |  Y   |
| :--: | :--: | :--: |
|  0   |  0   |  1   |
|  0   |  1   |  0   |
|  1   |  0   |  0   |
|  1   |  1   |  0   |

### 或门

或门=或非门+非门

![image](https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/7aa6ddb2c757445fe93d80432d054b0b1c4cd0c3.png)

|  A   |  B   |  Y   |
| :--: | :--: | :--: |
|  0   |  0   |  0   |
|  0   |  1   |  1   |
|  1   |  0   |  1   |
|  1   |  1   |  1   |

### 传输门

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260123220152992.png" alt="image-20260123220151204" style="zoom:50%;" />

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260123220210247.png" alt="image-20260123220208341" style="zoom:50%;" />

C和C'为一对互补的控制信号

- C为1时，P和N均导通，此时A和B连通
- C为0时，P和N均截止，此时A和B断开

### 三输入与非门

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260123220636589.png" alt="image-20260123220635149" style="zoom: 33%;" />

`Y = ~(A & B & C)`

晶体管数量对比：左图10个晶体管，右图6个晶体管

### 异或运算（异或门，XOR）

两个输入不同时为`1`，相同时为`0`

![image](https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/1ac31d265c8c7b5c399114c3beaa45e8d78af000.png)

|  A   |  B   |  Y   |
| :--: | :--: | :--: |
|  0   |  0   |  0   |
|  0   |  1   |  1   |
|  1   |  0   |  1   |
|  1   |  1   |  0   |

> 由真值表得到逻辑表达式,相应步骤如下:
>
> 1. 根据输入情况描述一个表项. 对于真值表中的每个表项, 考虑每个输入信号, 若输入为`1`, 则取输入信号本身; 若输入为`0`, 则取输入信号的非. 对这些信号进行与运算, 即可得到该表项的描述. 例如, 表中`A = 1, B = 0`的对应描述是`A & ~B`.
> 2. 将输出为`1`的表项的对应描述组合成最终的逻辑表达式. 考虑真值表中输出为`1`的表项, 对这些表项的描述进行或运算即可. 例如, 在异或运算的真值表中, 输出为`1`的情况有两种, 一种是`A = 1, B = 0`, 对应描述是`A & ~B`; 另一种是`A = 0, B = 1`, 对应描述是`~A & B`. 将这两种描述进行或运算, 得到异或运算的逻辑表达式`Y = A ^ B = (A & ~B) | (~A & B)`.

### 同或运算（同或门）

输入相同为1，输入不同为0

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260123223043005.png" alt="image-20260123223039500" style="zoom:50%;" />

|  A   |  B   |  Y   |
| :--: | :--: | :--: |
|  0   |  0   |  1   |
|  0   |  1   |  0   |
|  1   |  0   |  0   |
|  1   |  1   |  1   |

逻辑表达式：`Y=(~A&~B)|(A&B)`



## 门电路的面积

### CMOS电路的对等设计原则

0和1的电气特性应当一致，这样使用者只需关心电路逻辑

- 输出0所产生的电流，应当与输出1所吸收的电流一致（$I_{Y=1}=-I_{Y=0}$）
- 输出1时电流经过p管所产生的电压降，应当与输出0时电流经过n管所产生的电压降一致（$V_{CC}-V_{Y=1}=V_{Y=0}-V_{GND}$）

### 门电路面积

定义一个最小晶体管模型，将其面积定义为单位1

此处认为p型晶体管和n型晶体管面积相同

**定义`#T(X)`为门电路X中包含的等效最小晶体管的数量**

非门的拓扑结构对称，所以`#T(not)=2`

与非门拓扑结构不对称，电压降不满足对等设计原则。因此调整n管，使得电阻为原来的一半（增加尺寸、将原来每个n管分别替换为2个n管并联）

```
#T(nand)=1+1+2+2=6
#T(and)=8,#T(nor)=6,#T(or)=8,#T(tg)=2
//tg为transmission gate
```

三输入与非门：`#T(nand)=#T(and)+#T(nand)=14`

晶体管层面三输入与非门：`#T(nand3)=3#T(P1)+3#T(N1)=12`（每个n管的电阻变成原来的$1/3$）

对于多输入的门电路：

- 用晶体管来搭建，面积和输入数量呈二次关系
- 用二输入门电路来搭建，面积和输入数量呈线性关系



## 进位计数法

### 二进制计数法

### 十六进制计数法



## 通过门电路搭建基本组合逻辑电路

### 译码器

一种将k位输入转换成最多$2^k$种不同输出的电路

#### n选1译码器

将n位输入看成真值x，使$2^n$位输出中仅第x位为1（独热码one-hot）

常用于寻址

2-4译码器

<img src="https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/cff133cf0330c0254c2f4d0997d4c66c487dbccc.png" alt="image" style="zoom:67%;" />

| $A_1$ | $A_0$ |      | $Y_3$ | $Y_2$ | $Y_1$ | $Y_0$ |
| :---: | :---: | :--: | :---: | :---: | :---: | :---: |
|   0   |   0   |      |   0   |   0   |   0   |   1   |
|   0   |   1   |      |   0   |   0   |   1   |   0   |
|   1   |   0   |      |   0   |   1   |   0   |   0   |
|   1   |   1   |      |   1   |   0   |   0   |   0   |

#### 转码器

按照指定规则将一种编码的输入转换成另一种编码的输出

**不要求输出最多只包含有1个1**

##### 常见应用：七段数码管译码器

7段发光二极管+1个小数点

将一组4位的输入信号解析为二进制整数, 然后输出一组用于控制七段数码管亮灭情况的控制信号, 使得七段数码管可以显示和输入对应的数字

```
   a
  ---
f| g |b
  ---
e|   |c
  ---    .h
   d
   
input    output
        abcdefgh
 0100   01100110
```



### 编码器

功能和n选1译码器相反，用于将独热码转换成相应的二进制数值

- 若输入$2^n$位独热码，且第x位为1，则输出n位真值x的二进制数
- 若输出不为独热码，则输出undefined
- 用途：根据独热码生成地址；找出独热码中1的位置

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260125204443805.png" alt="image-20260125204430728" style="zoom:50%;" />

| $A_3$ | $A_2$ | $A_1$ | $A_0$ |      | $Y_1$ | $Y_0$ |
| :---: | :---: | :---: | :---: | :--: | :---: | :---: |
|   0   |   0   |   0   |   1   |      |   0   |   0   |
|   0   |   0   |   1   |   0   |      |   0   |   1   |
|   0   |   1   |   0   |   0   |      |   1   |   0   |
|   1   |   0   |   0   |   0   |      |   1   |   1   |
|  其   |  他   |  情   |  况   |      |   X   |   X   |

#### 利用未定义情况简化编码器设计

不关心其他情况的输出，只需要保证在输入为独热码时能得到正确的输出

$Y_0=A_1|A_3$

$Y_1=A_2|A_3$

#### 优先编码器(priority encoder)

支持独热码以外的输入，但只编码优先级最高的位

- 若输入不为0，则输出最高位1的位置
- 若输入为0，则输出为undefined

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260125222951637.png" alt="image-20260125222949771" style="zoom:50%;" />

| $A_3$ | $A_2$ | $A_1$ | $A_0$ |      | $Y_1$ | $Y_0$ |
| :---: | :---: | :---: | :---: | :--: | :---: | :---: |
|   0   |   0   |   0   |   1   |      |   0   |   0   |
|   0   |   0   |   1   |   X   |      |   0   |   1   |
|   0   |   1   |   X   |   X   |      |   1   |   0   |
|   1   |   X   |   X   |   X   |      |   1   |   1   |
|   0   |   0   |   0   |   0   |      |   X   |   X   |

### 多路选择器

根据选择端选择一路输入

将来对数据来源和处理结果进行选择

![image-20260126143705557](https://gitee.com/helloworld-dlx/typora/raw/master/20260126143723730.png)

![image](https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/257e79181d040da7483b0f1fd8ffd648085fa471.png)

| $S$  |      |  $Y$  |
| :--: | :--: | :---: |
|  0   |      | $D_0$ |
|  1   |      | $D_1$ |

> ### 1. 核心逻辑：AND门是“守门员”
>
> 与门（AND Gate）在这里的特殊用法：**门控（Gating）**。
>
> - **与门的特性**：
>   - $A \cdot 0 = 0$ （强制清零/拦截）
>   - $A \cdot 1 = A$ （原样通过/放行）
>
> 在这个电路里，两个与门就是两个守门员。
>
> - 上面的与门负责看管 $D_0$。
> - 下面的与门负责看管 $D_1$。
> - 谁能通过，完全取决于中间那个**1-2译码器（其实就是反相器逻辑）**发给谁“通行证（逻辑1）”。
>
> ### 2. 调度中心：1-2 Decoder
>
> 这个方块的作用是保证**互斥**。它确保了在任何时候，**发出的两张通行证，只有一张是有效的（为1）**，另一张必然失效（为0）。
>
> - **当 S = 0 时**：
>   - 给上面发 1 $\rightarrow$ 上面的 AND 门打开 $\rightarrow$ **$D_0$ 被放行**。
>   - 给下面发 0 $\rightarrow$ 下面的 AND 门关闭 $\rightarrow$ **$D_1$ 被拦截（输出0）**。
> - **当 S = 1 时**：
>   - 情况正好反过来，**$D_1$ 放行，$D_0$ 拦截**。
>
> ### 3.最后的或门有什么用？
>
> 在数字电路中，你不能把两根电线直接拧在一起（这叫线与/线或，通常会导致短路或逻辑电平冲突）。你需要一个逻辑门把两路信号**安全地合并**成一路。
>
> **或门（OR Gate）在这里起到了“汇聚”和“透传”的作用。**
>
> 利用或门的特性：**$X + 0 = X$**。
>
> - 假设 $S=0$，选中了 $D_0$。
>   - 上路输出：$D_0$ （也就是真实的信号，可能是0也可能是1）
>   - 下路输出：**0** （因为被拦截了，死死锁在0）
>   - **或门运算**：$D_0 + 0 = D_0$
> - 假设 $S=1$，选中了 $D_1$。
>   - 上路输出：**0** （被拦截了）
>   - 下路输出：$D_1$
>   - **或门运算**：$0 + D_1 = D_1$

#### 用传输门实现多路选择器

<img src="https://gitee.com/helloworld-dlx/typora/raw/master/20260126144917399.png" alt="image-20260126144913295" style="zoom:50%;" />

### 比较器

检查两个输入的每一位是否完全一致

<img src="https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/4ed5c5580eee6c4962049d6ecbc6e06c18ee5e76.png" alt="image" style="zoom:67%;" />

### 加法器

#### 1位加法器

半加法器（Half Adder）：输入无进位的加法器

```
S=A^B
C=A&B
```

| `A`  | `B`  |      | `S`  | `C`（进位） |
| :--: | :--: | :--: | :--: | :---------: |
|  0   |  0   |      |  0   |      0      |
|  0   |  1   |      |  1   |      0      |
|  1   |  0   |      |  1   |      0      |
|  1   |  1   |      |  0   |      1      |

全加器（Full Adder）：输入有进位的加法器

```))
S=A^B^Cin
Cout=(A&B)|(Cin&(A^B))
```

#### 多位加法器

行波进位加法器（Ripple-Carry Adder,RCA)

将低位FA的进位输出作为高位FA的进位输入

![image](https://ysyx.oscc.cc/slides/2306/resources/img/tikz-images/245e89032204ce190201ccb95c41bbbfbfdddb8a.png)